[gd_resource type="BehaviorTree" load_steps=27 format=3 uid="uid://d3n17chf6pmom"]

[ext_resource type="BBNode" uid="uid://0demvrghyqcn" path="res://ai/tasks/pathfinding_bb_node.tres" id="1_g0yeh"]
[ext_resource type="Script" path="res://ai/tasks/CheckIfAtPath.gd" id="2_k5kwd"]
[ext_resource type="Script" path="res://ai/tasks/QueueMove.gd" id="3_4471d"]

[sub_resource type="Resource" id="Resource_kmxge"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_60i7a"]
var/pathfinding_node_var/name = &"pathfinding_node_var"
var/pathfinding_node_var/type = 22
var/pathfinding_node_var/value = NodePath("Services/Navigation Service/Pathfinding")
var/pathfinding_node_var/hint = 0
var/pathfinding_node_var/hint_string = ""
var/path_to_enemy/name = &"path_to_enemy"
var/path_to_enemy/type = 36
var/path_to_enemy/value = PackedVector3Array()
var/path_to_enemy/hint = 0
var/path_to_enemy/hint_string = ""
var/current_position/name = &"current_position"
var/current_position/type = 9
var/current_position/value = Vector3(0, 0, 0)
var/current_position/hint = 0
var/current_position/hint_string = ""
var/closest_name_position/name = &"closest_name_position"
var/closest_name_position/type = 9
var/closest_name_position/value = Vector3(0, 0, 0)
var/closest_name_position/hint = 0
var/closest_name_position/hint_string = ""
var/test/name = &"test"
var/test/type = 4
var/test/value = ""
var/test/hint = 0
var/test/hint_string = ""
var/unit_name/name = &"unit_name"
var/unit_name/type = 4
var/unit_name/value = ""
var/unit_name/hint = 0
var/unit_name/hint_string = ""
var/enemy_node_number/name = &"enemy_node_number"
var/enemy_node_number/type = 4
var/enemy_node_number/value = ""
var/enemy_node_number/hint = 0
var/enemy_node_number/hint_string = ""
var/path_length_var/name = &"path_length_var"
var/path_length_var/type = 2
var/path_length_var/value = 0
var/path_length_var/hint = 0
var/path_length_var/hint_string = ""
var/unit_stat_sheet/name = &"unit_stat_sheet"
var/unit_stat_sheet/type = 24
var/unit_stat_sheet/value = SubResource("Resource_kmxge")
var/unit_stat_sheet/hint = 0
var/unit_stat_sheet/hint_string = ""
var/unit_ap_var/name = &"unit_ap_var"
var/unit_ap_var/type = 2
var/unit_ap_var/value = 0
var/unit_ap_var/hint = 0
var/unit_ap_var/hint_string = ""
var/target_name_var/name = &"target_name_var"
var/target_name_var/type = 4
var/target_name_var/value = ""
var/target_name_var/hint = 0
var/target_name_var/hint_string = ""
var/next_to_trigger_var/name = &"next_to_trigger_var"
var/next_to_trigger_var/type = 1
var/next_to_trigger_var/value = false
var/next_to_trigger_var/hint = 0
var/next_to_trigger_var/hint_string = ""
var/target_position_vec3/name = &"target_position_vec3"
var/target_position_vec3/type = 9
var/target_position_vec3/value = Vector3(0, 0, 0)
var/target_position_vec3/hint = 0
var/target_position_vec3/hint_string = ""

[sub_resource type="BBVariant" id="BBVariant_5if5a"]
type = 9
value_source = 1
variable = &"current_position"
resource_name = "$current_position"

[sub_resource type="BBNode" id="BBNode_yigew"]
saved_value = NodePath("Services/Navigation Service/Pathfinding")
resource_name = "Services/Navigation Service/Pathfinding"

[sub_resource type="GDScript" id="GDScript_40ldw"]

[sub_resource type="BTCallMethod" id="BTCallMethod_uiil6"]
node = SubResource("BBNode_yigew")
method = &"find_closest_player_position"
result_var = &"closest_name_position"
args = Array[BBVariant]([SubResource("BBVariant_5if5a")])
custom_name = "Find Closest Player Position"
script = SubResource("GDScript_40ldw")

[sub_resource type="BBVariant" id="BBVariant_qe4kr"]
type = 9
value_source = 1
variable = &"current_position"
resource_name = "$current_position"

[sub_resource type="BBVariant" id="BBVariant_7uuc3"]
type = 9
value_source = 1
variable = &"closest_name_position"
resource_name = "$closest_name_position"

[sub_resource type="BBVariant" id="BBVariant_nb0ri"]
type = 24
value_source = 1
variable = &"unit_stat_sheet"
resource_name = "$unit_stat_sheet"

[sub_resource type="BTCallMethod" id="BTCallMethod_o5wi0"]
node = ExtResource("1_g0yeh")
method = &"find_path_AI"
result_var = &"path_to_enemy"
args = Array[BBVariant]([SubResource("BBVariant_qe4kr"), SubResource("BBVariant_7uuc3"), SubResource("BBVariant_nb0ri")])
custom_name = "Return Path To Position"

[sub_resource type="GDScript" id="GDScript_d2f8o"]
script/source = "@tool
extends BTConsolePrint

func _tick(delta: float):
	print(\"Testing 1TWO3\")
	#print(blackboard.get_var(\"path_length_var\"))
	#var ss = (blackboard.get_var(\"target_position_vec3\"))
	#print(ss)
	print(\"REGO\", blackboard.get_var(\"closest_name_position\"))
	var unit_name = blackboard.get_var(\"unit_name\")
	var startpos = Planning.snapshot_enemy_positions[unit_name]
	blackboard.set_var(\"current_position\", startpos)
	print(blackboard.get_var(\"unit_ap_var\"))
	return SUCCESS

"

[sub_resource type="BTConsolePrint" id="BTConsolePrint_2cvlk"]
script = SubResource("GDScript_d2f8o")

[sub_resource type="BBVariant" id="BBVariant_pnmvw"]
type = 2
saved_value = 1
resource_name = "1"

[sub_resource type="BTCheckVar" id="BTCheckVar_oes38"]
variable = &"path_length_var"
check_type = 3
value = SubResource("BBVariant_pnmvw")
custom_name = "Check If Next To"
script = ExtResource("2_k5kwd")

[sub_resource type="BBVariant" id="BBVariant_yxj55"]
type = 36
value_source = 1
variable = &"path_to_enemy"
resource_name = "$path_to_enemy"

[sub_resource type="BTCallMethod" id="BTCallMethod_vs5w0"]
node = ExtResource("1_g0yeh")
method = &"get_last_element"
result_var = &"target_position_vec3"
args = Array[BBVariant]([SubResource("BBVariant_yxj55")])
custom_name = "Get Last Element Of PackedVector3"

[sub_resource type="BTConsolePrint" id="BTConsolePrint_3u647"]
script = SubResource("GDScript_d2f8o")

[sub_resource type="BTAction" id="BTAction_6l455"]
script = ExtResource("3_4471d")
Queue_Type = ""
target_position = Vector3(0, 0, 0)
unit_name = ""

[sub_resource type="BBVariant" id="BBVariant_owtiy"]
type = 2
saved_value = 1
resource_name = "1"

[sub_resource type="BTSetVar" id="BTSetVar_q4khb"]
variable = &"unit_ap_var"
value = SubResource("BBVariant_owtiy")
operation = 2

[sub_resource type="BTSequence" id="BTSequence_uk0qb"]
custom_name = "Stride To Closest Enemy"
children = [SubResource("BTCallMethod_uiil6"), SubResource("BTCallMethod_o5wi0"), SubResource("BTConsolePrint_2cvlk"), SubResource("BTCheckVar_oes38"), SubResource("BTCallMethod_vs5w0"), SubResource("BTConsolePrint_3u647"), SubResource("BTAction_6l455"), SubResource("BTSetVar_q4khb")]

[sub_resource type="BTSequence" id="BTSequence_fn2bw"]
custom_name = "Actions"
children = [SubResource("BTSequence_uk0qb")]

[sub_resource type="BTSequence" id="BTSequence_ak8tq"]
children = [SubResource("BTSequence_fn2bw")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_60i7a")
root_task = SubResource("BTSequence_ak8tq")
